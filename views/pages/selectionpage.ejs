<!DOCTYPE html>
<html>
<head>
    <% include ../partials/header.ejs %>    
</head>

<script>
    $(document).ready(function () {
        // Disable create game button until they have selected a DM profile
        $("#game-creation-btn").attr("disabled", "disabled");

    });

function isDMSelected() {
    var dmradio = document.getElementsByClassName("dmradio");

    for(var i = 0; i < dmradio.length; i++) {
        if (dmradio[i].checked) {
        var dmname1 = dmradio[i].value;
        document.getElementById("game-creation-btn").disabled = false;

        var data = {
            dmname: dmname1
        };

        $.post("set_dm_id.php", data);
    }
    }
}

function isCharacterSelected() {
    var characterradio = document.getElementsByClassName("characterradio");

    for(var i = 0; i < characterradio.length; i++) {
        if (characterradio[i].checked) {
            // if player selects a character, disable game-creation button (only available to DMs)
            document.getElementById("game-creation-btn").disabled = true;
            var characterradio1 = characterradio[i].value;

            var data = {
                character: characterradio1
            };

            $.post("set_character.php", data);
        }
    }
}

function isGameSelected() {
    var gamesradio = document.getElementsByClassName("gamesradio");

    for(var i = 0; i < gamesradio.length; i++) {
        if (gamesradio[i].checked) {
            var gamesradio1 = gamesradio[i].value;

            var data = {
                gamename: gamesradio1
            };

            $.post("set_gamename.php", data);
        }
    }
}
</script>
</head>
<body>
    <div id='selection'> 
        <h2> Select the DM or character you wish to use to play or create a new one! </h2> 

            <div id="playerordm">
        
            <!-- PLAYER SELECTION -->
            <div id="character-selection">
                <h5 class='tiletitles'> Choose a character...<br>
                    <button id="createCharacterButton" type="button" data-toggle="modal" data-target="#createCharacterModal"> Create a new Character </button><br>

             <!-- <input type="radio" name="player-selection" class="characterradio" onclick="isCharacterSelected()" value="'.$row['avatarname'].'">' . $row['avatarname'] . ' ' . '<img src="'. $row['imgpath'] .'">' . '<br/>'; -->
            </div>

            <span> OR... </span>

            <!-- DM SELECTION -->
            <div id="dm-selection">
            <span class='tiletitles'> Choose a Dungeon Masters Profile...<br>
            
                <!-- <input type="radio" name="player-selection" class="dmradio" onclick="isDMSelected()" value='.$row['dmname'].'>' . $row['dmname'] . '<br/> -->
            <button id="dm-creation-btn" type="button"> Create new DM Profile </button><br>
            <button id="game-creation-btn" type="button"> Create a new Game </button><br>
            </div>
            </div>

            <!-- GAME SELECTION -->
            <div id="game-selection">
            <span class='tiletitles'> Choose a game to join...<br>
                <!-- <input type="radio" name="games-selection-btn" class="gamesradio" onclick="isGameSelected()" value='.$row['gamename'].'>' . $row['gamename'] . '<br/> -->
            <button id="enterGame" type="button" > Enter Game </button><br>
            <!-- onclick="window.location.href=\'play-game.php\'" -->
            </div>
            
        
    </div>

    <!-- Create Character Modal -->
    <div class="modal fade" id="createCharacterModal" role="dialog">
            <div class="modal-dialog">
            
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Create a character</h4>
                </div>
                <div class="modal-body">
                    <form id="createCharacterForm" enctype="multipart/form-data">
                        Character name: <input type="text" name='avatarname'> <br>
                        <hr>
                        Upload an image: <input type="file" name='characterpic'>
                        <button id='createCharacterButtonModal' type="submit" class="btn btn-success" data-dismiss="modal">Create Character</button>
                    </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>
                </div>
            </div>
            
            </div>
        </div>

    <!-- Create DM Profile Modal
    <div class="modal fade" id="createDMProfileModal" role="dialog">
        <div class="modal-dialog">
        
        <div class="modal-content">
            <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Create a DM Profile</h4>
            </div>
            <div class="modal-body">
                Dungeon Master's name: <input type="text" name='dmName'> <br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>
                <button id='createCharacterButtonModal' type="button" class="btn btn-success" data-dismiss="modal">Create Character</button>
            </div>
        </div>
        
        </div>
    </div> -->

</body>
<script>
// $('#createCharacterButtonModal').click(function() {
    $('#createCharacterForm').submit(function(event){
        event.preventDefault();
    $.ajax({
        url: "https://pacific-reef-42179.herokuapp.com/addCharacter",
        type: "POST",
        data: {
            "characterName" : $('[name="avatarname"]').val(),
            "imgPath" : $('[name="characterpic"]').val(),
        }, 
        statusCode: {
            500: function(res) {
                alert("Server error: " + JSON.stringify(res));
            },
            200: function(res) {
                alert("successfully added character to database");
                alert(JSON.stringify(res));

            }
        }
    });
});

// $('#dm-creation-btn').click(function() {
//     $.ajax({
//         url: "https://pacific-reef-42179.herokuapp.com/addDM",
//         type: "GET",
//         data: {
//             "characterName" : $('[name="avatarname"]').val(),
//             "imgPath" : "testImgPath.jpg",
//             "userid" : ""
//         }, 
//     });
// });
</script>
</html>